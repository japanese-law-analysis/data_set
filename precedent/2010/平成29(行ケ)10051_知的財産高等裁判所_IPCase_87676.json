{
  "trial_type": "IPCase",
  "date": {
    "era": "Heisei",
    "year": 30,
    "month": 4,
    "day": 12
  },
  "case_number": "平成29(行ケ)10051",
  "case_name": "審決取消請求事件",
  "court_name": "知的財産高等裁判所",
  "right_type": "特許権",
  "lawsuit_type": "行政訴訟",
  "lawsuit_id": "87676",
  "detail_page_link": "https://www.courts.go.jp/app/hanrei_jp/detail7?id=87676",
  "full_pdf_link": "https://www.courts.go.jp/app/files/hanrei_jp/676/087676_hanrei.pdf",
  "contents": "平成３０年４月１２日判決言渡\n平成２９年（行ケ）第１００５１号  審決取消請求事件\n口頭弁論終結の日  平成３０年２月８日\n判                決\n原 告   アンスティテュ  ミーヌーテレコム\n同訴訟代理人弁理士    木村高 久\n同     小幡義 之\n被 告    特 許 庁 長 官\n同指定 代理 人   高木   進\n同                    石井茂 和\n同                    佐久聖 子\n同                    野崎大 進\n同                    板谷玲 子\n主                文\n１  原告の請求を棄却する。\n２  訴訟費用は原告の負担とする。\n３  この判決に対する上告及び上告受理申立てのための付加期間\nを３０日と定める。\n事実及び理 由\n第１  請求\n特許庁が不服２０１４－２６７９２号事件について平成２８年１０月１３日\nにした審決を取り消す。\n第２  前提事実（いずれも当事者間に争いがない。）\n１  特許庁における手続の経緯等\n原告は，発明の名称を「その暗号変換により特に情報漏洩観測攻撃から保護\nされる暗号回路」とする発明について，平成２２年１月１８日（パリ条約によ\nる優先権主張外国庁受理２００９年１月２０日  仏国）に特許出願をした（特\n願２０１１－５４６７７１号。以下「本願」という。）。これに対し，平成２\n６年１月１５日付けで拒絶理由が通知されたことから，原告は，同年５月２日\nに手続補正書等を提出したが，同年９月４日付けで拒絶査定がされた。\nそこで，原告は，同年１２月２６日，特許庁に対し，拒絶査定不服審判を請\n求した。これに対し，特許庁は，当該審判請求を不服２０１４－２６７９２号\n事件として審理をし，原告に対し，平成２７年９月１７日付けで拒絶理由を通\n知した。これを受け，原告は，平成２８年３月２５日，特許請求の範囲の変更\nを内容とする別紙手続補正書を提出したが，特許庁は，同年１０月１３日，\n「本件審判の請求は，成り立たない。」との審決をした（出訴期間として９０\n日を附加した。以下「本件審決」という。）。その謄本は，同月２５日，原告\nに送達された。\n原告は，平成２９年２月２２日，本件訴えを提起した。\n２  本願発明\n本願に係る発明は，別紙手続補正書により補正された特許請求の範囲請求項\n１～５に記載された事項により特定されるものであるところ（以下，請求項の\n順に「本願発明１」のようにいい，本願発明１～５を併せて「本願発明」とい\nう。また，本願に係る別紙明細書及び図面を「本願明細書等」という。），そ\nの記載は，以下のとおりである。\n【請求項１】\n暗号化アルゴリズムを実行するための関数鍵 kc を含む暗号回路（２１）で\nあって，前記回路は，前記回路に専用の第２の鍵 ki であって，前記回路のサイ\nドチャネルを利用した攻撃から回路を保護することを可能とする第２の鍵 ki を\n含むことを特徴とする回路であって，\n前記関数鍵 kc は XOR 演算によって前記２つの鍵を組み合わせることにより\n前記第２の鍵 ki によってマスクされ，入力変数 x はマスク鍵\n【数１】\nによって暗号化され，\n前記暗号回路は，FPGA タイプのプログラマブル回路において実現され，\n前記暗号回路は，前記 FPGA タイプのプログラマブル回路のプログラミング\nファイル（２５）を暗号化するための第３の鍵 kb を含み，\n前記第２の鍵 ki は PUF（Physically Unclonable Function）により生成されるこ\nとを特徴とする回路。\n【請求項２】\n前記第２の鍵 ki によって導入されるマスキングは HO-DPA 攻撃から保護さ\nれることを特徴とする，請求項１に記載の回路。\n【請求項３】\n前記第２の鍵 ki の基数は前記関数鍵 kc の基数に等しいことを特徴とする，\n請求項１または２に記載の回路。\n【請求項４】\n前記第３の鍵 kb の基数は前記関数鍵 kc の前記基数よりも大きいかまたは等\nしいことを特徴とする，請求項１に記載の回路。\n【請求項５】\n前記暗号化アルゴリズムは DES アルゴリズムであることを特徴とする，請\n求項１～４のいずれか１項に記載の回路。\n３  本件審決の理由の要旨\n本件審決の理由は，別紙審決書（写し）記載のとおりであるが，要するに，\n以下のとおり，本願発明１は，特許法（以下「法」という。）３６条６項２号\n及び同条４項１号の要件を欠き，これを引用する本願発明２～５も同様であり，\nまた，本願発明１は，国際公開第２００７／１０２８９８号公報（甲１。以下\n「引用文献１」という。）記載の発明（以下「引用発明」という。）に，特開\n２００３－５１８２０号公報（甲２。以下「引用文献２」という。）ないし周\n知慣用の技術に基づいて当業者が容易になし得るものであり，本願発明１の奏\nする作用効果もこれらから当然予測される範囲内のものに過ぎず，格別顕著な\nものということはできないから，法２９条２項により特許を受けることができ\nず，本願発明２～５について検討するまでもなく，本願は拒絶すべきものであ\nるとした。\n(1)  法３６条６項２号について\n一般に，データの暗号化と復号化とが対となって別々の装置を用い，あ\nる装置（例えば送信側）で暗号化されたデータは別の装置（例えば受信側）\nで復号化されることによりデータを暗号化する目的が実現されるところ，本\n願発明１は「暗号化アルゴリズムを実行するための関数鍵 kc を含む暗号回\n路（２１）であって，…第２の鍵 ki は PUF（Physically Unclonable Function）\nにより生成される」事項を有することから，前記「PUF により生成される」\n「第２の鍵 ki」に係る暗号化と復号化が対となると解されるが，例えば復号\n化側の別の装置では（PUF はクローン不能であるから，前記別の装置では第\n２の鍵 ki と同じ鍵を持つことはできないので）復号化できないと解される。\n本願明細書等の記載（【０００２】）には，前記２つの側（送信側と受信側）\nが同一である場合の言及はあるとしても，本願発明１は「同一」であるとの\n限定はしておらず，前記２つの側が同一である場合，別々である場合のいず\nれの場合も，暗号化されたデータをどのように復号化するのかが不明であっ\nて，どのように（復号可能に）暗号化するのか明確に記載されたものとはい\nえず，しかも，技術的意義も不明である。\nこのため，本願発明は，法３６条６項２号の要件を満たしていない。\n(2)  法３６条４項１号について\n本 願 発 明 １ は 「 kc⊕ki に よ っ て 暗 号 化 さ れ ， … 第 ２ の 鍵 ki は PUF\n（Physically Unclonable Function）により生成される」事項を有する回路の発\n明であるが，当該暗号化に関連する復号化について発明の詳細な説明には説\n明されておらず，前記第２の鍵 ki は PUF（物理的クローン不能関数）により\n生成されるものであるから，マスク鍵（kc⊕ki）により暗号化された入力変数\nx を何を用いてどのように復号すればよいのか，暗号化／復号化に係る回路\nは唯一の回路を用いるのか，別の回路を用いるのか，前記唯一の回路を用い\nて暗号化と復号化をする技術的意義はどのようなものなのか不明であり，ま\nた，別の回路を用いるならいかにして同じ PUF により生成される第２の鍵\nki を有する別の回路が得られるのか不明である。\nしたがって，本願明細書等に係る発明の詳細な説明は，当業者が本願発\n明を実施することができる程度に明確かつ十分に記載されたものではない。\n(3)  法２９条２項について\nア  引用発明\nDES 暗号アルゴリズムを実行するための暗号キーを含む DES 計算ユニ\nット，キーマスキングユニット，メモリを含む暗号ハードウェアであっ\nて，\n前記ハードウェアは，マスクを用いるマスキング方法（偽またはダミ\nー演算）の使用により，あるラウンドにおける暗号化アルゴリズム置換\n（S ボックス）演算の（キー側の）入力値のサイドチャネル攻撃からのハ\nードウェアエンジンを保護することを可能とするマスクを含むハードウ\nェアであって，\n前記キーは XOR 演算によって前記キーとマスクとを用いてマスキング\nをかけたキーを生じさせ，入力データは前記マスキングをかけたキーに\nよって XOR 演算が適用されて暗号化され，\n前記マスクは事前に構築されたマスキング表を用いて生成されること\nを特徴とする暗号ハードウェア。\nイ  対比\n本願発明１と引用発明とを対比すると，一致点及び相違点は，以下の\nとおりである。\n［一致点］\n暗号化アルゴリズムを実行するための関数鍵 kc を含む暗号回路であっ\nて，前記回路は，第２の鍵 ki であって，前記回路のサイドチャネルを利用\nした攻撃から回路を保護することを可能とする第２の鍵 ki を含むことを特\n徴とする回路であって，\n前記関数鍵 kc は XOR 演算によって前記２つの鍵を組み合わせることに\nより前記第２の鍵 ki によってマスクされ，入力変数 x はマスク鍵\n【数１】\nkc⊕ki\nによって暗号化され，\n前記第２の鍵 ki は手段を用いることにより生成されることを特徴とする\n回路。\n［相違点１］\n回路に係る第２の鍵 ki（マスク）であることに関し，本願発明１は「回\n路に専用の」第２の鍵 ki であるのに対し，引用発明は，そのような事項を\n有していない点。\n［相違点２］\n本願発明１は，「暗号回路は，FPGA タイプのプログラマブル回路のプ\nログラミングファイルを暗号化するための第３の鍵 kb を含」むのに対し，\n引用発明は，そのような事項を有していない点。\n［相違点３］\n前記第２の鍵 ki は手段を用いることにより生成されることに関し，本願\n発明１は「PUF（Physically  Unclonable  Function）」により生成されるのに\n対し，引用発明は，そのような事項を有していない点。\nウ  判断\n(ｱ)  相違点１及び３について\n引用文献２には，「マスクは，物理的アンクローンナブルな物理的パ\nラメータネットワーク（Function；関数，機能）により生成される」技\n術が示されている。\nまた，引用発明と引用文献２とは，いずれも暗号化保護のための技術\nに係るものである。\nそうすると，引用発明において，回路に係る第２の鍵 ki（マスク）で\nあることに関し，「前記回路に専用の」第２の鍵 ki であるとなすこと，\n及び，前記第２の鍵 ki（マスク）は所定の手段を用いることにより生成\nされることに関し，「PUF（Physically  Unclonable  Function）」により生\n成されるとなすことは，引用文献２の前記技術を参酌することにより当\n業者が容易になし得ることである。\n(ｲ)  相違点２について\n特表２００４－５１９１１１号公報（甲４。以下「参考文献１」とい\nう。）及び特表２００８－５１２９０９号公報（甲５。以下「参考文献\n２」という。）に見られるように，FPGA プログラムが意図する特定の\n組の FPGA 以外の FPGA をプログラムするための FPGA プログラムの使\n用を阻止するため，あるいは，単一のセキュアな集積回路チップ上に暗\n号処理要素を設けることを目的として「暗号化回路は，FPGA タイプの\nプログラマブル回路において実現され，前記回路は，前記 FPGA タイプ\nのプログラマブル回路のプログラミングファイルを暗号化するための鍵\nを含む」技術は，周知の技術であったと認められる。\nそうすると，引用発明において「前記暗号回路は，FPGA タイプのプ\nログラマブル回路において実現され，前記暗号回路は，前記 FPGA タイ\nプのプログラマブル回路のプログラミングファイルを暗号化するための\n第３の鍵 kb を含」むとなすことは，前記周知の技術を参酌することに\nより容易になし得ることである。\n(ｳ)  したがって，本願発明１は，引用発明，引用文献２ないし周知慣用\nの技術に基づいて当業者が容易になし得るものであり，その奏する作\n用効果は，引用発明，引用文献２ないし周知慣用の技術の奏する作用\n効果から当然予測される範囲内のものに過ぎず，格別顕著なものとい\nうことはできないのであり，法２９条２項により特許を受けることが\nできない。\n第３  当事者の主張\n１  原告の主張\n(1)  取消事由１（本願発明１の認定の誤り）\nア  本願発明１における関数鍵 kc とは，暗号化アルゴリズムを実行する鍵\nのことであり，具体的には，DES アルゴリズム２３に入力されてこれを\n実行し，入力変数 x から暗号文 y を出力することに機能する鍵である（本\n願明細書等の図４）。より具体的には，関数鍵 kc は，本願明細書等の図\n１又は２において Feistel 関数 f に入力されて暗号化処理に適用される鍵で\nある（裁判所注：図１及び２には「Feisted」とあるが，正しくは「Feistel」\nである。以下，図１又は２に言及する場合を含め，後者によ り表記す\nる。）。ここで，「暗号化アルゴリズム」の操作とは，本願発明１の\n「暗号化アルゴリズムを実行する」操作であり，関数鍵 kc によって暗号\n化アルゴリズムを実行して暗号文 y を出力する操作を意味する。\n他方，マスク鍵 kc⊕ki とは，あくまで入力変数 x を暗号化するだけのも\nのである。ここで，「暗号化」の操作とは，本願発明１の「入力変数 x は\nマスク鍵 kc⊕ki によって暗号化され」る操作であり，暗号化アルゴリズム\nの操作の一部である。\nイ  一般に，鍵を用いて入力変数 x を暗号化する際に，サイドチャネルを利\n用した攻撃によって情報の漏洩が生じるおそれがある。そこで，本願発\n明１では，マスク鍵 kc⊕ki を用いて入力変数 x を暗号化する。このため，\nマスク鍵 kc⊕ki は，サイドチャネルを利用した攻撃の攻撃者によって解読\nされる（可能性のある）鍵である（本願明細書等【００２８】）。\n本願明細書等の記載（【００４０】）及び図４にあるとおり，関数鍵 kc\nは，暗号化アルゴリズムを実行して入力変数 x から暗号文すなわち暗号化\nされた変数 y（=DES（x，kc））を出力することに機能する。このため，\n最終的に入力変数 x から生成して出力される暗号文を復号する（攻撃者に\nとっては解読する）ためには，Feistel 関数 f に入力されて暗号化処理に適\n用される鍵，つまり暗号化アルゴリズムを実行することに機能する関数\n鍵 kc を知る必要がある。しかるに，サイドチャネルを利用した攻撃の攻\n撃者によって漏洩される（可能性のある）鍵は，上記のとおり，マスク\n鍵 kc⊕ki でしかない。サイドチャネルを利用した攻撃によって攻撃者が上\n記マスク鍵を知ったとしても，そこから関数鍵 kc を推測することは，第\n２の鍵 ki が未知であるため容易なことではなく，このため，暗号文から平\n文である入力変数 x を復号する（攻撃者にとっては解読する）ことはでき\nない（本願明細書等【００４６】）。本願発明１の意義は，以上の点に\nある。\nウ  しかし，本件審決は，本願発明１の認定に当たり，本願発明１の上記意\n義をなんら認定しなかった。この点で本件審決には誤りがある。\n(2)  取消事由２（本願発明１と引用発明との一致点及び相違点の認定の誤り）\nア  引用文献１には「マスキングをかけたキーを使用して DES 暗号アルゴ\nリズムを実行し，結果を出力データとしてメモリ３１に再び書き込む。」\n（引用文献１に対応する特表２００９－５１６９６４号公報（甲１７）\nの【００３４】。以下，引用文献１の訳（段落番号を含む。）は同公報\nによる。）との記載がある。このため，引用発明において暗号アルゴリ\nズムを実行し，暗号文を出力させることに機能するキーは，マスキング\nをかけたキーである。\n他方，引用文献１には「アルゴリズムの S ボックスの入力側におけるア\nルゴリズムの実行のその部分を直接標的にすることができる。」（【０\n００６】）と記載されており，サイドチャネルを利用した攻撃がされる\nのは，S ボックスの入力側である。また，引用文献１の図２には，S ボッ\nクス S1 の入力側に，キーK1 をマスク[15]によってマスクしたキーを用い\nてデータ１を暗号化することが示されている。このため，引用発明にお\nいてサイドチャネルを利用した攻撃の攻撃者によって漏洩される（可能\n性のある）キーは，マスキングをかけたキーである。\n以上より，引用発明において暗号文を復号する（攻撃者にとっては解\n読する）ためには，マスキングをかけたキーを知れば足り，マスキング\nをかける対象となるキーを知る必要はない。\nイ  したがって，本願発明１と引用発明とを対比すると，本願発明１では，\nマスキングの対象となるキー，すなわち第２の鍵 ki によってマスキングさ\nれる対象となる関数鍵 kc が，暗号化アルゴリズムを実行して暗号文を出\n力することに機能するのに対して，引用発明の「暗号キー」は，それ単\n独で暗号化アルゴリズムを実行して暗号文を出力することに機能するも\nのではなく，暗号キーとマスクとが XOR 演算された「マスキングをかけ\nたキー」が暗号アルゴリズムを実行して暗号文を出力することに機能す\nる，という点で異なる。\nウ  そうすると，本件審決は，本願発明１と引用発明との一致点として「暗\n号化アルゴリズムを実行するための関数鍵 kc」を認定している点で誤りで\nある。\n(3)  取消事由３（容易想到性に関する認定の誤り）\nア  相違点２に関する本件審決の認定・判断については，実質的に争わない。\nイ  相違点１及び３について\n(ｱ)  前記のとおり，本願発明１と引用発明とは，本願発明１では，マス\nキングの対象となるキー，すなわち第２の鍵 ki によってマスキングされ\nる対象となる関数鍵 kc が，暗号化アルゴリズムを実行して暗号文を出\n力することに機能するのに対して，引用発明の「暗号キー」は，それ\n単独で暗号化アルゴリズムを実行して暗号文を出力することに機能す\nるものではなく，暗号キーとマスクとが XOR 演算された「マスキング\nをかけたキー」が暗号アルゴリズムを実行して暗号文を出力すること\nに機能する，という点で異なる。\nこのため，本願発明１では，サイドチャネルを利用した攻撃によって\n攻撃者がマスク鍵 kc⊕ki を知ったとしても，そこから関数鍵 kc を推測す\nることは，第２の鍵 ki が未知であるため容易なことではなく，その結果，\n暗号文を復号する（攻撃者にとっては解読する）ことはできないのに対\nし，引用発明では，サイドチャネルを利用した攻撃によって攻撃者がマ\nスキングをかけたキーを知ることができれば暗号文を復号することがで\nきてしまうという点で，両者は発明の作用効果の点でも異なる。\nさらに，引用発明では，真のマスクを用いた真の演算以外に，ダミー\nマスクを用いたダミー演算を実行する必要があるとともに，真のメッセ\nージ以外にダミーメッセージを生成する必要があるのに対し，本願発明\n１では，ダミー演算及びダミーメッセージの生成は不要である。\nこのように，本願発明１は，引用発明に対して顕著な作用効果を奏功\nすることから，引用発明から容易に想到されるものではない。\n(ｲ)  引用文献２には「データ d はメモリ２（MEM）に直接には蓄積され\nず，集積回路チップの物理的パラメータネットワークにより提供され\nる量の測定値（ブロック４，MES）からくる物理データ p と組合される\n（ブロック３，COMB）。値 f（d，p）はこの組合せの関数で，メモリ\n２（例えば EEPROM）に蓄積される。」（【００３７】）と記載され\nている。したがって，引用文献２には，データ d と物理データ p を組み\n合わせ，その結果の値 f（d，p）をメモリに蓄積するという発明が記載\nされている。\nしかし，引用文献２に示されるデータ d，物理データ p，値 f（d，p）\nは，いずれも，本願発明１の「第２の鍵 ki によってマスクされる鍵であ\nって，暗号化アルゴリズムを実行する関数鍵 kc」，「暗号化アルゴリズ\nムを実行する関数鍵 kc をマスクする第２の鍵 ki」，「入力変数 x をマス\nクするマスク鍵 kc⊕ki（暗号化アルゴリズムを実行する関数鍵 kc と第２\nの鍵 ki が XOR 演算によって組み合わせられた鍵）」に相当しない。\nそうである以上，引用発明に引用文献２を組み合わせても，本願発明\n１は容易に想到されるものではない。\n(ｳ)  引用発明１におけるマスク[0]，マスク[1]，…マスク[63]は，テーブ\nル表より既知の鍵である。これに対し，引用文献２には，マスクが物\n理的にアンクローンナブルであることが示されている。\nしかるに，引用発明のマスク[0]等を「物理的にアンクローンナブル」\nなマスクに置換したとしても，引用発明において，設計者にとって未知\nである「物理的にアンクローンナブル」なマスクを含むメッセージデー\nタが暗号アルゴリズムから出力されることとなりメッセージデータを復\n号化することができない。\nそうである以上，引用発明に引用文献２を組み合わせることには阻害\n事由があり，これらを組み合わせて本願発明１を容易に想到することは\nできない。\n(ｴ)  参考文献１及び参考文献２には本願発明１の「第２の鍵 ki によって\nマスクされる鍵であって，暗号化アルゴリズムを実行する関数鍵 kc」，\n「暗号化アルゴリズムを実行する関数鍵 kc をマスクする第２の鍵 ki」，\n「入力変数 x をマスクするマスク鍵 kc⊕ki（暗号化アルゴリズムを実行\nする関数鍵 kc と第２の鍵 ki が XOR 演算によって組み合わせられた鍵）」\nに相当する構成は何ら示されていない。\nそうである以上，引用発明に参考文献１及び２を組み合わせても，本\n願発明１は容易に想到されるものではない。\n(4)  取消事由４（実施可能要件に関する認定の誤り）\nア(ｱ)  本願発明を実施するための事項は，以下のとおり，本願明細書等に\n記載されており，実施可能要件を満たしている。\n(ｲ)  本願明細書等の「関数鍵 kc が回路２１の暗号化を実施する役割を果\nたす。この暗号化は例えばレジスタ２２の内部で入力変数 x を暗号化さ\nれた変数 y=DES（x，kc）に変換する DES アルゴリズム２３である。」\n（【００４０】）との記載及び図４によれば，本願明細書等には，回\n路２１に，入力変数 x が入力されるとともに関数鍵 kc が入力され，回路\n２１で DES アルゴリズムを実行し，暗号文 y=DES（x，kc）を出力する\nという事項が記載されているということができる。これは，本願の請\n求項１の「暗号化アルゴリズムを実行するための関数鍵 kc を含む暗号\n回路（２１）」の記載に相当する。\nまた，本願明細書等の「暗号鍵９，k はまた Feistel 関数１０によりマ\nスク m によってマスクされる。」（【００２７】）との記載並びに図\n１及び２によれば，図１及び２の回路に示される鍵 kc が，マスク m に\nよってマスクされる暗号鍵であるということが理解される。そして，本\n願明細書等には，図１及び２に示される回路の説明として「K⊕M  つ\nまり秘密鍵 K それ自体がマスク M により暗号化される。」との記載\n（【００２８】）があるところ，上記回路の（マスク m によってマス\nクされる）暗号鍵 kc は，（マスク M によってマスクされる）秘密鍵 K\nと同一である。ここで，秘密鍵とは，暗号文 y の復号化に必要な鍵であ\nって暗号化アルゴリズム F（x，k）を実行するための鍵 k であると定義\nされる。そうすると，本願明細書等の上記記載並びに図１及び２には，\n秘密鍵 kc が，マスク m によって，K⊕M という形式でマスクされて暗号\n化されるものの，図１及び２に示される回路で暗号化アルゴリズム F\n（x，kc）を実行すると，暗号文 y=F（x，kc）が出力される（秘密鍵 kc\nが暗号文 y の復号化に必要な鍵である）ことが示されているといえる。\nこれは，本願の請求項１の「暗号化アルゴリズムを実行するための関数\n鍵 kc を含む暗号回路（２１）」の記載に相当する。\n(ｳ)  本願の請求項１の「入力変数 x は，マスク鍵 kc⊕ki によって暗号化さ\nれ」につき，本願明細書等の図４には，関数鍵 kc が，マスク（第２の\n鍵）ki と XOR ゲートで XOR 演算されて（kc⊕ki），DES アルゴリズム２\n３の内部のレジスタ２２に入力されることが示されている。 他方，同\n図には，入力変数 x が，DES アルゴリズム２３に入力されることも示さ\nれている。このため，DES アルゴリズム２３に入力された入力変数 x は，\nDES アルゴリズム２３の内部のレジスタ２２に入力されたマスク鍵\nkc⊕ki によって暗号化されることを，当業者であれば理解する。\nまた，本願明細書等の「左右のデータレジスタに保存される前に，メ\nッセージのデータは左で XOR ゲート７および右で XOR ゲート８という\n手段によりマスクデータと組み合わされることによってマスクされる。\n暗号鍵９，k はまた Feistel 関数１０によりマスク m によってマスクされ\nる。」（【００２７】）との記載並びに図１及び２によれば，XOR ゲ\nート８で，メッセージデータ（入力変数 x）と第２の鍵 ki が XOR 演算\n（x⊕ki）されていること，及びこの演算結果がレジスタ６を経て Feistel\n関数１０に入力され，E で示される箇所を経て，関数鍵 kc と XOR 演算\n（x⊕ki⊕kc）されていることが，それぞれ理解される。 排他的論理和⊕\n（XOR 演算子）は，その左辺と右辺を交換しても計算結果は同じであ\nり（交換法則），計算の優先順位を変えても計算結果は同じである（結\n合法則）ことから，Feistel 関数１０に入力され，E で示される箇所を経\nて得られた x⊕ki⊕kc は，x⊕(kc⊕ki)となる。そうすると，図１及び２には，\n「マスク鍵 kc⊕ki によって入力変数 x が暗号化され（x⊕(kc⊕ki)）」という\n事項が示されているといえる。\n(ｴ)  本願明細書等の記載（【００３７】）及び図３によれば，図３にお\nいて，入力データ X が x⊕kc であり，マスク M が第２の鍵 ki であるとす\nると，レジスタ３１の前段の XOR 演算部で x⊕kc⊕ki の演算がされ，いず\nれのレジスタにおいても第２の鍵 ki によってマスキングがされることに\nより，x⊕kc は漏洩されないが，レジスタ３５の後段の XOR 演算部から\nは第２の鍵 ki がデマスキングされた E（x⊕kc）が出力されるという事項\nが示されているといえる。\nまた，本願明細書等の図２においても，図３と同様に，Feistel 関数１\n０内の E の後段の XOR 演算部で x⊕kc⊕ki の演算がされ，いずれのレジス\nタにおいても第２の鍵 ki によってマスキングがされて，x⊕kc は漏洩され\nないが，XOR 演算部１３，１４からは，第２の鍵 ki がデマスキングさ\nれた暗号文が出力されるという事項が示されているといえる。\nイ(ｱ)  本願発明は，その名称が示すとおり「その暗号変換により特に情報\n漏洩観測攻撃から保護される暗号回路」に関し，暗号回路においてサイ\nドチャネル攻撃から保護されることを課題とする。したがって，本願発\n明の暗号回路を実施するための事項を発明の詳細な説明に記載すれば足\nり，暗号回路を実施するための事項以外の事項である復号を実施するた\nめの事項が発明の詳細な説明に記載されていないことをもって，実施可\n能要件を満たしていないということにはならない。\n(ｲ)  マスク鍵 kc⊕ki によって暗号化された入力変数 x を，暗号回路から\n「y=DES（x，kc）」として第２の鍵 ki を用いない形式で出力すること\nは可能である。\nすなわち，本願明細書等の図２に示されるとおり，本願発明において\nは，暗号化アルゴリズムに XOR ゲート７，８，１２，１３，１４を付\n加することによって，第２の鍵 ki は，マスク鍵 kc⊕ki のために使用され\nる一方で，XOR 演算を繰り返すことによって最終的に消去される。こ\nのため，出力１５（同図）から最終的に得られた暗号文 y を解読するた\nめには，関数鍵 kc さえ知り得ればよく，第２の鍵 ki を要しない。この\nことは，本願発明の出願時における当業者の技術常識をもって理解し得\nる。\nウ  以上より，実施可能要件に関する本件審決の認定は誤りである。\n(5)  取消事由５（明確性要件に関する認定の誤り）\n本願の請求項１に「マスク鍵 kc⊕ki によって暗号化された入力変数 x を，\n暗号回路から第２の鍵 ki を用いない形式で出力でき，出力されたものを関数\n鍵 kc によって復号できる」ことが記載されていることについては，取消事\n由４と同様である。\nしたがって，明確性要件に関する本件審決の認定は誤りである。\n２  被告の主張\n(1)  取消事由１（本願発明１の認定の誤り）に対し\nア  本件審決は，特許請求の範囲に記載された事項により特定されるものと\nして本願発明１の認定を行ったものであり，その認定に誤りはない。\nイ(ｱ)  原告は，本願発明１における関数鍵 kc とは，暗号化アルゴリズムを\n実行する鍵のことであり，具体的には，DES アルゴリズム２３に入力\nされてこれを実行し，入力変数 x から暗号文 y を出力することに機能す\nる鍵のことであり，「暗号化アルゴリズム」の操作とは，本願の請求項\n１に記載の「暗号化アルゴリズムを実行する」操作であり，関数鍵 kc\nによって暗号化アルゴリズムを実行して（最終的に）暗号文を出力する\n操作を意味する旨主張する。\nしかし，本願発明１に係る特許請求の範囲には「暗号化アルゴリズム\nを実行するための関数鍵 kc を含む暗号回路（２１）であって」と記載\nされているに過ぎず，「関数鍵 kc」につき，「暗号化アルゴリズムを実\n行するための関数鍵 kc」であることや「関数鍵 kc を含む暗号回路」と\n特定されているものの，「関数鍵 kc」が単独で「暗号化アルゴリズムを\n実行する鍵のことであ」ることや「関数鍵 kc によって暗号化アルゴリ\nズムを実行して（最終的に）暗号文を出力する」ことは，何ら特定され\nていない。\nしたがって，原告の上記主張は，本願の特許請求の範囲の記載に基づ\nくものではない。\n(ｲ)  原告は，最終的に入力変数 x から生成して出力される暗号文を復号す\nる（攻撃者にとっては解読する）ためには，Feistel 関数 f に入力されて\n暗号化処理に適用される鍵，つまり暗号化アルゴリズムを実行するこ\nとに機能する関数鍵 kc を知る必要がある，関数鍵 kc が暗号化アルゴリ\nズムを実行して入力変数 x から暗号文，つまり暗号化された変数 y を出\n力することに機能することは，本願明細書（【００４０】， 図４）に\n「y=DES（x，kc）」として記載されているなどと主張する。\nしかし，本願発明１の特許請求の範囲には「入力変数 x はマスク鍵\n【数１】kc⊕ki によって暗号化され」と記載されているに過ぎず，「入\n力変数 x はマスク鍵 kc⊕ki で暗号化」されることは特定されているもの\nの，「関数鍵 kc が暗号化アルゴリズムを実行して入力変数 x から暗号\n文，つまり暗号化された変数 y を出力することに機能」することや，\n「y=DES（x，kc）」として出力されることについては，何ら特定され\nていない。\nしたがって，原告の上記主張は，本願の特許請求の範囲の記載に基づ\nくものではない。\n(ｳ)  原告は，本件明細書等の図１及び２の記載を根拠として，「暗号化」\nの操作とは本願の請求項１の「入力変数 x はマスク鍵 kc⊕ki によって暗\n号化され」る操作であり，マスク鍵 kc⊕ki によって入力変数 x を暗号化\nするという，暗号化アルゴリズムの操作の一部を意味するなどと主張\nするけれども，後記（(4)イ）のとおり，上記図１及び２の実施例は，\n本願発明１に係る特許請求の範囲に対応する実施例ではない。\n(ｴ)  仮に，原告の主張する本願発明１の意義を参酌してクレームを限定\n解釈し，「関数鍵 kc」が単独で「暗号化アルゴリズムを実行する鍵のこ\nとであ」ることや「関数鍵 kc によって暗号化アルゴリズムを実行して\n（最終的に）暗号文 y=DES（x，kc）を出力する」ことを本願発明１の\n構成として認定した場合であっても，引用発明においても，「関数鍵 kc\nによって暗号化アルゴリズムを実行して（最終的に）暗号文 y=DES（x，\nkc）を出力する」ことが実質的に記載されているといえるから，上記本\n願発明１の構成は，実質的な相違点とならない。\nしたがって，原告主張に従って本願発明１の上記構成を認定したとし\nても，容易想到性判断の結論には影響しない。\n(2)  取消事由２（本願発明１と引用発明との一致点及び相違点の認定の誤り）\nに対し\nア  原告は，鍵 kc に関し，本願発明１の関数鍵 kc は，暗号化アルゴリズム\nを実行して暗号文を出力することに機能するものである旨主張する。\nしかし，前記のとおり，本願発明１の特許請求の範囲には「暗号化ア\nルゴリズムを実行するための関数鍵 kc を含む暗号化回路（２１）であっ\nて」と記載されているに過ぎず，「暗号文を出力することに機能」する\nものであることは何ら特定されていないから，原告の上記主張は，本願\nの特許請求の範囲の記載に基づくものではない。\nイ  原告は，引用発明につき，引用発明の「暗号キー」は，それ単独で暗号\n化アルゴリズムを実行して暗号文を出力することに機能するものではな\nく，暗号キーとマスクとが XOR 演算された「マスキングをかけたキー」\nが暗号化アルゴリズムを実行して暗号文を出力することに機能する旨主\n張する。\nしかし，引用文献１の記載（【０００８】，【００１１】）によれば，\n引用文献１の暗号化アルゴリズムは，ランダム順で真及びダミーキーを\n使用しており，ダミーキーから間違った結果はダミーメモリロケーショ\nンに格納されるが，Zero でマスキングされたキーは「真のキー」として，\nその結果は真の結果としてメモリに格納される。ここで，Zero でマスキ\nングされたキーはマスキングされないキーと等価であることは明らかで\nあるので，引用発明の「『DES 暗号アルゴリズム』を実行するための暗\n号キーを含む DES 計算ユニット，キーマスキングユニット，メモリを含\nむ暗号ハードウェア」における「暗号キー」には，マスキングされたダ\nミーキーだけでなく，マスキングされないキーと等価である「真のキー」\nが含まれる 。すなわち，引用発明の「暗号キー」には ， 本願発明 １ の\n「関数鍵 kc」に相当するものも含まれるといえる。\nしたがって，引用発明に関する原告の上記主張は，引用文献１の記載\nの理解を誤ったものである。\n(3)  取消事由３（容易想到性に関する認定の誤り）に対し\nア  原告は，本願発明１では，マスキングの対象となるキー，つまり第２の\n鍵 ki によってマスキングされる対象となる関数鍵 kc が，暗号化アルゴリ\nズムを実行して暗号文を出力することに機能するのに対して，引用発明\nでは，マスキングをかけたキーが暗号アルゴリズムを実行して暗号文を\n出力することに機能するという点で異なるため，本願発明１は引用発明\nに対して顕著な作用効果を奏功する旨主張する。\nしかし，原告の上記主張は，前記(1)イ(ｱ)，(ｲ)及び(2)イのとおり，本願\n発明１についてはその特許請求の範囲の記載に基づくものとはいえず，\n引用発明についても，引用文献１の記載の理解を誤ったものである。\nイ  原告は，引用文献１に引用文献２を組み合わせても，引用文献２に示さ\nれるデータ d，物理データ p，値 f(d，p)は，いずれも，本願発明の「第２\nの鍵 ki によってマスクされる鍵であって，暗号化アルゴリズムを実行する\n関数鍵 kc」，「暗号化アルゴリズムを実行する関数鍵 kc をマスクする第\n２の鍵 ki」，「入力変数 x をマスクするマスク鍵 kc⊕ki（暗号化アルゴリズ\nムを実行する関数鍵 kc と第２の鍵 ki が XOR 演算によって組み合わせられ\nた鍵）」に相当しないから，相違点１及び３に係る構成には想到し得な\nい旨主張する。\nしかし，前記のとおり，本願の特許請求の範囲の記載では「暗号化ア\nルゴリズムを実行するための関数鍵 kc を含む暗号回路」，「入力変数 x は\nマスク鍵 kc⊕ki によって暗号化」との特定がされているものの，「第２の\n鍵 ki によってマスクされる鍵であって，暗号化アルゴリズムを実行する関\n数鍵 kc」，「暗号化アルゴリズムを実行する関数鍵 kc をマスクする第２\nの鍵 ki」，「入力変数 x をマスクするマスク鍵 kc⊕ki（暗号化アルゴリズム\nを実行する関数鍵 kc と第２の鍵 ki が XOR 演算によって組み合わせられた\n鍵）」という態様は，本願の特許請求の範囲で特定されていない。\nしたがって，原告の上記主張は，本願の特許請求の範囲の記載に基づ\nくものではない。\n(4)  取消事由４（実施可能要件に関する認定の誤り）及び取消事由５（明確\n性要件に関する認定の誤り）に対し\nア  本願発明を暗号回路として実施するための事項が本願明細書等に記載さ\nれているということはできない。\nすなわち，暗号回路といえるためには，復号可能な暗号化を実行する\nことが必要であることは，暗号技術分野の技術常識である。そして，本\n願の請求項では，入力変数 x をマスク鍵 kc⊕ki で暗号化しているから，暗\n号化の際と復号化の際には同じ秘密鍵が必要となるという共通鍵暗号の\n技術常識に照らし，復号化の際には暗号化の際に使用したマスク鍵 kc⊕ki\nが必要となる。\nしかし，サイドチャネル攻撃によって暗号化の際に使用した秘密鍵は\n特定されてしまうことから，秘密鍵 kc を使用する代わりにマスク鍵 kc⊕ki\nを使用して暗号化を行ったとしても，暗号解読に必要なマスク鍵 kc⊕ki が\n特定されてしまうことになる。これは，本願の請求項１の「サイドチャ\nネルを利用した攻撃から回路を保護することを可能とする第２の鍵 ki を含\nむことを特徴とする回路」という記載と整合しないから，上記請求項の\n記載は技術的に不明瞭となっている。\nまた，本願明細書等の実施例（図２及び４）によっても，入力変数 x を\nマスク鍵 kc⊕ki で暗号化しながら，出力暗号文として「y=DES（x，kc）」\nが出力されることが，当業者に実施可能な程度に具体的に記載されてい\nるということはできない。\nしたがって，本願の請求項は技術的に不明瞭であるから，明確性要件\nを満たしているとはいえず，また，本願明細書等には，本願の請求項に\n係る発明である回路を暗号回路として実施するための事項が記載されて\nいないから，実施可能要件を満たしているとはいえない。\nイ  本願明細書等の図２について\n(ｱ)  原告は，本願明細書等の図２を根拠として，第２の鍵 ki は，マスク\n鍵 kc⊕ki のために使用されるが，XOR 演算を繰り返すことによって消去\nされ，最終的に得られた暗号文 x⊕kc を解読するためには，関数鍵 kc さ\nえ知り得ればよく，第２の鍵 ki を要しない旨主張する。\n(ｲ)  しかし，図２では，入力変数 x であるメッセージに初期置換 IP１を\n行い（IP(x)），第２の鍵 ki にも初期置換 IP２を行い（IP(ki)），IP１の\n出力 IP(x) と IP ２ の 出 力 IP(ki) を XOR ゲ ー ト ８ で XOR 演 算 し て\n（IP(x)⊕IP(ki)），レジスタ６に格納している。そして，レジスタ６に格\n納され た IP(x)  ⊕IP(ki)に拡大置換 E を 行 い （ E(IP(x)⊕IP(ki))） ，出力\nE(IP(x)⊕IP(ki))と関数鍵 kc とで XOR 演算を行い（E(IP(x)⊕IP(ki))⊕kc），S\nボックス９への入力としている。\nこのうち，IP１の出力 IP(x)と IP２の出力 IP(ki)を XOR ゲート８で\nXOR 演算（IP(x)⊕IP(ki)）している点は，入力変数 x であるメッセージを\n第２の鍵 ki との XOR 演算によりマスクしているということができる。\n他方，S ボックス９への入力 E(IP(x)⊕IP(ki))⊕kc において，関数鍵 kc と第\n２の鍵 ki に着目すると，関数鍵 kc と第２の鍵 ki とで直接 XOR 演算を行\nっていない。そうすると，「関数鍵 kc は XOR 演算によって…第２の鍵\nki によってマスクされ」ているとはいえない。\n(ｳ)  また，初期置換 IP の入力は６４ビット幅であるから，第２の鍵 ki の\nビット幅は６４ビットである。他方，拡大置換 E の出力は４８ビット幅\nであるから，拡大置換 E の出力 E(IP(x)⊕IP(ki))のビット幅は４８ビット\nである。\nここで，XOR 演算は，同じビット幅を有する２つの２進数を入力と\nする２項演算であるという技術常識を踏まえると，拡大置換 E の出力\nE(IP(x)⊕IP(ki))との XOR 演算の対象となっている関数鍵 kc のビット幅は，\n拡大置換 E の出力 E(IP(x)⊕IP(ki))のビット幅と同じ４８ビットである。\n「入力変数をマスク鍵 kc⊕ki で暗号化」するためには，少なくとも第\n２の鍵 ki と関数鍵 kc とが間接的に XOR 演算していること，すなわち，\nE(IP(x)⊕IP(ki))⊕kc の演算順序を入れ換えて，例えば E(IP(x)⊕IP(ki⊕kc))  の\nように変換可能である必要があるが，初期置換 IP 及び拡大置換 E は，\nビット位置の入れ替えやビット幅の拡大を行っているから，初期置換\nIP 及び拡大置換 E 並びに XOR 演算の演算順序は入れ換え可能であると\nはいえない。仮に初期置換 IP 及び拡大置換 E 並びに XOR 演算の演算順\n序が入れ換え可能であったとしても，ビット幅の異なる第２の鍵 ki（ビ\nット幅６４ビット）と関数鍵 kc（ビット幅４８ビット）とは XOR 演算\nできない。\nしたがって，図２の実施例において，第２の鍵 ki と関数鍵 kc とは，\n間接的にも XOR 演算しているとはいえない。\n(ｴ)  以上より，図２の実施例において，第２の鍵 ki と関数鍵 kc とは，直\n接的にも間接的にも XOR 演算しているとはいえないから，同実施例は\n「入力変数をマスク鍵 kc⊕ki で暗号化」しておらず，「関数鍵 kc は XOR\n演算によって…第２の鍵 ki によってマスクされ」ているとはいえない。\nそうすると，同実施例は，本願の請求項に係る発明に対応する実施例\nということはできない。\nしたがって，図２の実施例に基づく原告の主張は，本願の請求項の記\n載に基づく主張でないから，理由がない。\n(ｵ)  仮に図２に記載の実施例が「入力変数をマスク鍵 kc⊕ki で暗号化」し\nているとしても，少なくとも，図２の S’１６は，DES アルゴリズムの\n基本構成である S ボックス９と区別され，S ボックス９とは異なり，２\nつの４８ビット幅の入力を持っている。しかし，図２の S’１６がどの\nような演算を行っているのかについて，本願明細書等には何ら記載も\n示唆もない。このため，図２に記載の実施例を当業者が実施すること\nはできず，実施可能要件を満たしているとはいえない。\n第４  当裁判所の判断\n１  本願発明\n本願発明に係る特許請求の範囲請求項の記載は，前記（第２の２）のとおり\nである。\n２  本願明細書等の記載等\n(1)  技術分野（【０００１】）\n本発明はそれらの暗号化により特に情報漏洩観測攻撃から保護される暗\n号回路に関する。\n(2)  背景技術\n通信および情報処理のための手段のローミング能力が増すとともに，新\nしい攻撃が考えられるようになっている。実行速度の点から，それを構成す\nる電子回路，例えば DPA 攻撃によるエネルギー消費量の点から，またはそ\nの放射挙動，例えば EMA 攻撃による磁気放射の点からシステムの時間的挙\n動を観測することにより大量の情報が漏洩しうる。サイドチャネルへのこれ\nらの攻撃に対しては，特に，\nこの例では秘密とは無関係に漏えいを一定にすることを伴う秘匿と，\n漏えいをランダムにすることを伴う，つまり予測不能でありしたがって\n利用不可能とするマスキングと，を基にする保護が提案されている。（【０\n００４】）\nこれらの２つの技法は情報の取得を狙った攻撃の困難さを増すことを可\n能とするが，それらはそれでもなお実装欠陥から利益を得るであろう攻撃に\n対 し て は 依 然 脆 弱 で あ る 。 DPA 攻撃の例は， P.Kocher ら に よ る 文 献 ，\nDifferential Power Analysis, In proceedings of CRYPT’99, volume 1666 of LNCS,\npages  338-397,  Springer-Verlag,  1999 に記載されている。EMA 攻撃の例は\nK.Gandolfi らによる文献，Electromagnetic Analysis-Concrete Results, In CHES,\nvolume 2162 of LNCS, pages 251-261, Springer-Verlag, 2001 に記載されている。\n（【０００５】）\n起こりうるまたは立証された脆弱性の例は数多く存在する。\n以下が特に挙げられる。\n差分論理（WDDL などの）に基づく秘匿は計算フェーズと評価フェーズ\nとプリチャージフェーズとのうちの１つまたは別の間の累積した組み合わせ\nのずれの差への攻撃に対して脆弱となる場合がある。\nマスキングは HO-DPA と呼ばれる高階攻撃に敏感な場合がある。（【０\n００６】）\n(3)  課題を解決するための手段\n本発明の目的は特にこれらの，特に DPA または EMA タイプの攻撃に対抗\nすることである。この目的のため，本発明の対象は暗号アルゴリズムを実行\nするための関数鍵 kc を含む暗号回路であって，前記回路は kc とは別の前記\n回路のそれぞれの例に特有の，回路のサイドチャネルを利用した攻撃から回\n路を保護することを可能とする第２の鍵 ki を含むことを特徴とする。（【０\n００７】）\n関数鍵 kc は例えば XOR 演算によって２つの鍵を組み合わせることにより\n第２の鍵 ki によってマスクされ，入力変数 x はマスク鍵\n【数１】\nkc⊕ki\nによって暗号化されている。（【０００９】）\n第２の鍵 ki は例えば秘密実装によって鍵 kc を保護する役割を果たす。\n（【００１０】）\n第２の鍵 ki は例えば特に鍵 ki でマスキングすることにより保護される２つ\nの秘密関数の囲い込みによってカスタマイズされる標準暗号アルゴリズムか\nらなる秘密アルゴリズムを保護する役割を果たす。（【００１１】）\n第２の鍵 ki は例えば PUF（Physically  Unclonable  Function）または POK\n（Physically  Obfuscated  Key）タイプの関数により生成される。（【００１\n２】）\n第２の鍵 ki により導入されるマスキングは HO-DPA 高階攻撃に対して保\n護されてもよい。（【００１４】）\n回路に固有の実装鍵としての役割を果たす第２の鍵 ki の知識により，例え\nば保護管理プロシージャを，前記管理を担う特権ユーザが使用することが可\n能となる。（【００１５】）\nこれは FPGA タイプのプログラマブル回路で実現されてもよい。（【００\n１６】）\n第２の鍵 ki は FPGA のプログラミングファイルを介してカスタマイズされ\nてもよい。（【００１７】）\n有利には，回路はソフトウェアの実装により実現されてもよい。（【０\n０１８】）\nそれは例えば前記 FPGA 回路のプログラミングファイル（２５）を暗号化\nし，これにより外部記憶の機密性および FPGA への鍵 ki の移転の機密性を付\n与するための第３の鍵 kb を含む。（【００１９】）\n第２の鍵 ki の基数は例えば関数鍵 kc の基数に等しい。これは ki への隠し\nチャネル攻撃を kc への暗号解読攻撃よりも困難にするためである。（【０\n０２０】）\n第３の鍵 kb の基数の基数は関数鍵 kc の基数よりも大きいかまたは等しい。\n（【００２１】）\nこの暗号化アルゴリズムは DES アルゴリズムである。（【００２２】）\n(4)  発明を実施するための形態\n図１に本発明が適用されうるマスキングのモードを呈示する。特に図１\nには，特に S.Guille らによる文献，A fast Pipelined MultiMode DES Architecture\nOperating in IP Representation, Integration, The VLSI Journal, 40(4) pages 479-489,\nJuly  2007,  DOI に概要が示されるアーキテクチャに従い実装される DES\n（Data  Encryption  Standard）アルゴリズムのマスキングの図が例として呈示\nされる。図１の回路は例えば FPGA（Field Programmable Gate  Array）タイプ\nのプログラマブル論理回路で実現される。このアルゴリズムでは，データパ\nスは２つの部分，左と右とに分割される。（【００２５】）\n対比のために，図２はマスキングによる保護を保証するためのハードウ\nェアオーバーヘッドを強調する同様の回路を示し，このオーバーヘッドを生\nじさせる回路は破線により示されている。（【００２６】）\nしたがって左のデータレジスタ３と右のデータレジスタ４との間に入力\nメッセージ１が割り当てられる。左のマスクレジスタ５と右のマスクレジス\nタ６との間にマスク２が割り当てられる。左右のデータレジスタに保存され\nる前に，メッセージのデータは左で XOR ゲート７および右で XOR ゲート８\nという手段によりマスクデータと組み合わされることによってマスクされる。\n暗号鍵９，k はまた Feistel 関数１０によりマスク m によってマスクされる。\n右のレジスタ６のマスクされるデータと右のレジスタ２の半分のマスクは，\nそこで右のマスクされるデータが第１の換字ボックス９により暗号化され，\nかつ，そこで右の半分のマスクが第２の換字ボックス１６により暗号化され\nる Feistel 関数の入力を形成する。左のデータレジスタ５と左のマスクレジス\nタ１のデータは XOR ゲート１１，１２という手段により Feistel 関数の出力\nにおいてそれぞれ右のデータと新しいマスクとに組み合わされ，その後右の\nレジスタにループ状に戻り，左右のデータはその後暗号化されたメッセージ\nを出力１５するように XOR ゲート１３，１４により再び組み合わされる。\n図１のタイプの回路ではデータレジスタ５，６のみが漏洩すると想定される。\n（【００２７】）\n本発明による回路は漏洩を続けるがそれを暗号化の状態にするため理解\nできない。したがって例えば DPA または EMA タイプの攻撃を実行する攻撃\n者には以下の変数のみがわかる。\n【数２】\nK⊕M                                  (1)\nつまり秘密鍵 K それ自体がマスク M により暗号化される。鍵 K のこの保\n護モードは，XOR とも呼ばれかつ\n【数３】\n⊕\nにより表される「排他的論理和」演算を用いる Vernam 暗号という名で公知\nであり，Vernam コードは XOR 演算を用いて暗号化することができるコード\nである。本発明による暗号回路はしたがって情報漏洩の Vernam 暗号化によ\nり隠しチャネルへの攻撃から保護される。（【００２８】）\n暗号化アルゴリズムが完全にカスタマイズされる用途分野が存在する。\n例えば秘密暗号に依存する GSM の公共または私用の範囲または有料テレビ\nがそのようなケースである。この選択を正当化するために通常述べられる主\n張には，回路と相関関係となる漏えい関数が未知であるためサイドチャネル\nへの攻撃，いわゆる SCA（Side-Channel Attacks）は不可能ということがある。\nK.Tiri ら の 文 献 ， Side-Channel  Leakage  Tolerant  Architectures,  In  ITNG’06-\nProceedings of the Third International Conference on Information Technology, New\nGeneration, pages 204-209, Washington DC, USA, 2006 IEEE Computer Society で\nは，アルゴリズムの実装および機能性を，ハードウェアの量の点でオーバー\nヘッド有りまたは無しで一度にかつ同時に変更することを提案している。前\nの２つのプロシージャの欠点は，暗号化が関数的に秘密であることである。\nこれはセキュリティの専門家がシステムおよびその配備を実施する特定の典\n型的な場合においては容認されうる。しかし暗号化システムの設計および配\n布を監視することが困難であるほとんどの場合，この筋書きは非常に不確実\nである。いったん秘密の機能性が回復すると，DPA タイプの攻撃は再度容\n易に可能となる。さらに例えば FIPS-140 などの特定の証明方式では，暗号\n標準をカスタマイズせずに使用することが要求される。これにより特に\nK.Tiri らによる文献で支持される SCA に耐性のある全プロシージャは禁止と\nされる。（【００２９】）\n本発明によれば，特にこの暗号化の公知の関数の仕様に完全に準拠する\n一方で暗号化を実施するためには，保護される暗号回路専用のマスクを使用\nしてマスキングによる保護が実施される。本発明による回路には，回路専用\nのマスク M が単に一定であり，かつ，回路の使用者または設計者にとって\n未知であるマスキングアーキテクチャが含まれる。（【００３０】）\n図１によるマスキングパスは，実際，上述の式（１）に従い１次 DPA 攻\n撃つまりデータレジスタ５，６のみが漏洩すると想定される攻撃の枠組み内\nで暗号鍵の Vernam 暗号化を実施することが実証されうる。さらにマスキン\nグ周囲のいかなるバリアントもまた本発明を実施するために使用することが\nでき，事実，実装は機能性を保持する一方でリファレンス実装とは異なるよ\nうに表されることで十分である。マスキングの場合，リファレンス実装はゼ\nロマスク（全ゼロ）を有するものと一致するが，マスクが非ゼロになるとす\nぐに，実装はしかしながら機能性を変更することなく変化する。ここで，実\n装に可変性を導入するように表現を変えることもまた可能である。例えば A\nNew DPA Countermeasure Based on Permutation Tables. In SCN, volume 5229 of\nLecture  Notes  in  Computer  Science,  pages  278-292.  Springer において，Jean-\nSebastian CORON は AES の基本演算部分を２つの全単射，４ビット→４ビッ\nトを導入して変更することを提案しているが，そのような方式でそれらを組\nみ立てることにより実際は従来の AES の計算が得られる。この表現の変化\nもまた秘密実装のきっかけとなりうるが，その情報漏えいはしかしながらこ\nの文献では研究されない。（【００３１】）\nしたがって漏えいモデルが未知であるため１次相関攻撃は不可能とされ\nる。さらに，いわゆる「テンプレート」攻撃などの，測定値のセットまたは\nカタログの構造に依存する攻撃は各実装が特有であり，汎用のカタログを構\n築することが不可能であるため実行不可能とされる。（【００３２】）\n有利には，本発明において実装の多様性は暗号鍵の数に匹敵するまたは\n実際同等である。特に「第２の原像」タイプの攻撃はしたがって不可能であ\nる。活動中の回路と同じマスクを有する，鍵がプログラム可能な回路を偶然\nに見つける確率は，正しい鍵を偶然に推測する，つまりブルートフォースア\nタックによる鍵への全数探索で成功する確率に匹敵するかまたは実際，同等\nである。（【００３３】）\n図１の例では，マスキングを実装するために付加されたハードウェアは\n左１と右２のマスクレジスタおよびマスクをデータと組み合わせる XOR ゲ\nート１２，１３，１４ならびに右のマスクレジスタの出力を処理する Feistel\n関数の換字回路１６で形成される。（【００３４】）\nASIC または FPGA をベースにした実現の枠組み内では，他のタイプの暗\n号プリミティブのマスキングはソースコード上で直接動作する適切な CAD\nツールの支援で自動化されてもよい。（【００３５】）\n保護プロシージャは一般にサイドチャネルを介して漏洩するかもしれな\nい秘密を含むあらゆる実装に適用できることを記すことは興味深い。直接の\n例は暗号鍵の保護であるが，署名鍵は同様の方式で等しく十分に保護される。\nさらに暗号アルゴリズムのパラメータを保護する代わりに，それが秘密の場\n合，アルゴリズムそれ自体を保護することもまた可能である。これは通信が\n２地点 間 で 暗 号 化 さ れ る た め （ サ テ ラ イ ト タ ワ ー ド デ コ ー ダ （ satellite\ntoward  decoder）），共同利用できない暗号が実装されうる有料テレビなど\nの分野で起こる。したがってその中の１または２以上の要素（換字表または\n拡散関数などの）を変更する一方で標準化アルゴリズムを使用することは普\n通である。この方式で，そのセキュリティを弱体化するリスクを冒すことな\nくアルゴリズムのカスタム化が達成される。（【００３６】）\n図３は別の進行方式を示す。この例では，標準アルゴリズム A はそのま\nまで再利用されるが，実行される関数がもはや A ではなく，合成\n【数４】\nになるように，それは外部符号（EEin および EEout）で囲い込まれる。この\n原理の説明が C. Clavier による論文，Secret External Encodings Do Not Prevent\nTransient Fault Analysis, in CHES’07, volume 4727 of Lecture Notes in Computer\nScience,  pages  181-194 の序章にある。図３の左の部分３０，３１，３２はマ\nスキング技法によって数値 EE(X)の漏洩をどう防ぐことができるかを示す。\n関数 EE３０は２つのレジスタ３１，３２により囲い込まれ，そこで第１の\nレジスタ３１はデータ\n【数５】\nx⊕m\nを受信する。並列に配置された\n【数６】\nとして画定される関数 EE’３３はデマスキングが依然として可能であること\nを保証する。したがって図３の右の部分に示されるハードウェア３３，３４，\n３５の付加によって，アルゴリズムへの入力 X が何であるとしてもいずれ\nのレジスタも EE(x)を含まない。この方式で，秘密の外部符号 EE について\nの任意の情報項目をバックトラックすることが不可能となる。以下では，し\nかしながら，普遍性を失うことなく，暗号鍵の漏えいに対する保護の典型的\nな場合に重点が置かれる。（【００３７】）\nFPGA タイプというソリューションによって各回路が大規模な配置時でさ\nえもそれ独自のコンフィギュレーションを有することが有利に可能となる。\n特に FPGA のソリューションでは，それをカスタマイズするために数値を変\n更するために，特に構成要素専用のマスクなどのシステム全体をリコンパイ\nルする必要はない。これは，Kerckhoffs の原理に背いておらず，それぞれの\n実装は実際に秘密であるが独特であることを示唆している。実装を妥協する\nことでセットアップすべてを妥協することは認められない。（【００３８】）\n特定の FPGA 回路の機能性の懐古的な設計は，それが恒久的な可読メモリ\n内に配置されるファイル内のソフトウェアに関してプログラムされるという\n事実によって可能とされうる。そのような懐古的な設計を避けるため「ビッ\nトストリーム」と呼ばれる，このファイルの暗号化を可能にする FPGA タイ\nプを使用することが可能である。したがって保護はそれ自体が暗号手段によ\nり秘密にされる。コード難読化は機械語から高レベル仕様へのバックトラッ\nキングを対象とした演算を複雑化するための追加の受けである。（【００３\n９】）\n図４は本発明による典型的な回路を概略的におよび簡略化した様式で示\nす。FPGA タイプであるこの回路２１には３つの鍵がある。関数鍵 kc が回路\n２１の暗号化を実施する役割を果たす。この暗号化は例えばレジスタ２２の\n内部で入力変数 x を暗号化された変数 y=DES（x，kc）に変換する DES アル\nゴリズム２３である。（【００４０】）\n非機能の鍵 ki が関数鍵 kc をマスクする役割を果たす。関数鍵のマスク M\nを形成するのはこの鍵 ki であり，XOR 演算子がこれら２つの鍵を組み合わ\nせて\n【数７】\nkc⊕ki\nにする。鍵 ki はしたがって DES 実装の関数鍵 kc を磁気放射または特に瞬間\n消費の観測による情報漏洩２４から保護する役割を果たす。（【００４１】）\n別の非機能の鍵 kb は「ビットストリーム」ファイル２５の秘密要素，つ\nまり少なくとも ki または実際 kc を保護する役割を果たす。（【００４２】）\nこの手法では鍵は以下のような方式でサイズが決められることが好まし\nい。\n｜ki｜＝｜kc｜    （２）\nおよび   ｜kb｜≧｜kc｜    （３）\n｜ki｜，｜kb｜，｜kc｜はそれぞれ ki の，kb の，および kc の基数を表す。\n（【００４３】）\n本発明によれば，暗号アルゴリズム２３の実装は暗号化された変数 y が変\n数の暗号鍵 kc を保護する鍵 ki と関数的に独立するようにされ，セットアッ\nプの情報漏洩は\n【数８】\nほども多様である（２の｜ki｜乗）。（【００４４】）\nDES アルゴリズムの場合，y=DES（x，kc，ki）であり，y は ki と関数的に\n独立である。（【００４５】）\n【数９】\nkc⊕ki，ki\nと ki が使用者または設計者にとってを含め完全に未知であることを知った上\nで kc を推測する必要があるため，１次攻撃は単により困難とされるだけで\nなく不可能とされることに留意されたい。これにより本発明は高度の信頼を\n提供し，\n【数１０】\nよりも少ない計算力を有するいかなる敵対者に対しても安全が立証される。\nこれは｜ki｜＝｜kc｜の場合の DES アルゴリズムそれ自体のセキュリティレ\nベルに等しい。（【００４６】）\nPUF（Physically  Unclonable  Functions）または POK（Physically  Obfuscated\nKey）タイプの関数（すなわち実装固有の物理的鍵），または回路２１に固\n有の秘密を，外部から供給される鍵の代わりに PKI と呼ばれる公開鍵基盤ま\nたは信頼をカスタマイズするための他のあらゆるメカニズムによって生成さ\nせることが可能な他のあらゆるシステムを使用することが可能である。\n（【００４７】）\n第２の鍵 ki はなお回路の作製後にセキュアな筐体内で単一の乱数を用いて\nプログラムされうる。（【００４８】）\n「Shallow  Attack」の名でも知られる組み合わせ論理回路への攻撃または\nHO-DPA 攻撃に対する対抗措置をさらに使用する定数マスクを用いたマスキ\nングメカニズムを使用することもまた可能である。（【００４９】）\nS.Mangard ら に よ る 文 献 ， Successfully  Attacking  Masked  AES  Hardware\nImplementations, In LNCS, editor, Proceedings of CHES’05, volume 3659 of LNCS,\npages 157-171, Springer, September 2005, Edinburgh, Scotland に特に呈示されて\nいるような，秘密マスクにほとんど依存しない「グリッチ」とも呼ばれる非\n機能の遷移の存在を利用したアルゴリズムのマスキングへの攻撃は，それを\n知らずに回路のシミュレーションを実行することが不可能であるため，秘密\n実装には当てはまらないことに留意されたい。事実，この攻撃は事前特性化\nモデルとの相関に依存する。この工程は本発明による回路では ASIC で生成\nされたマスクの設計または FPGA の「ビットストリーム」ファイルを知って\nいる，またはマスクが選択されるサンプルを所持するであろう熟知しうる攻\n撃者を除いては実行不可能である。この可能性を防止するため，前に記載さ\nれた PUF 関数が特に使用できる。（【００５０】）\n特定の独自のアルゴリズム，特に２つの秘密符号間でカプセル化された\n標準アルゴリズムは，C.Clavier による文献，Secret External Encodings Do Not\nPrevent  Transient  Fault  Analysis,  In  CHES,  volume  4727  of  Lecture  Notes  in\nComputer  Science,  pages  181-194,  Springer,  2007 で特に示されるように摂動攻\n撃に耐性がない。このクラスの攻撃では攻撃者はレジスタの値を例えば\n0x00 などの既知の値に固定できることが必要とされる。本発明による実装\n鍵 ki により保護される回路では，データレジスタとマスクレジスタとが互い\nに素である場合，攻撃者はそこで簡単な欠陥を発生させるよりもはるかに困\n難な複数の欠陥を達成する必要があるため，これは事実上非常に困難である。\n（【００５１】）\n実装鍵 ki を有する本発明による保護のタイプでは，例えば RTL レベルで\nは符号化の点において，または物理的レベルではカプセル化の点において欠\n陥を検知するための通常の保護などの他の保護と有利に併用することができ\nる。これにより受動的な攻撃および能動的な攻撃の両方に対して高度の保護\nを達成することを可能とする。（【００５２】）\n３  以上を踏まえると，本願明細書等には，本願発明について，以下の事項が\n記載されているものと認められる。\n(1)  技術分野\n本願発明は，情報漏洩観測攻撃から保護される暗号回路に関するもので\nある（【０００１】）。ここでいう情報漏洩観測攻撃は，例えば，DPA 攻\n撃によるエネルギー消費量の観点又は EMA 攻撃による磁気放射の観点から，\nシステムの時間的挙動を観測することによるサイドチャネル攻撃のことであ\nる（【０００４】）。\n(2)  課題\nDPA 攻撃及び EMA 攻撃のような情報漏洩観測攻撃に対しては，漏洩を秘\n密とは無関係に一定にすることによる秘匿，及び漏洩を予測不能にすること\nで利用不可能とするマスキングを基にする保護が提案されている（【０００\n４】）。しかし，これらの２つの技法は，実装欠陥から利益を得るであろう\n攻撃に対しては依然 脆弱である（【００ ０５】）。例えば， 差分論理\n（WDDL などの）に基づく秘匿は，計算フェーズと評価フェーズとプリチ\nャージフェーズとのうちの１つ又は別の間の累積した組合せのずれの差への\n攻撃に対して脆弱となる場合があり，また，マスキングは HO-DPA と呼ば\nれる高階攻撃に敏感な場合がある（【０００６】）。\n本願発明の目的は，これらの攻撃，特に DPA 又は EMA タイプの攻撃に対\n抗することである（【０００７】）。\n(3)  課題解決手段\n前記目的のため，本願発明は，暗号アルゴリズムを実行するための関数\n鍵 kc を含む暗号回路であって，前記回路は kc とは別の前記回路のそれぞれ\nの例に特有の，回路のサイドチャネルを利用した攻撃から回路を保護するこ\nとを可能とする第２の鍵 ki を含むことを特徴とする（【０００７】）。\n関数鍵 kc は，例えば XOR 演算によって２つの鍵を組み合わせることによ\nり第２の鍵 ki によってマスクされ，入力変数 x はマスク鍵 kc⊕ki によって暗\n号化されている（【０００９】）。\n第２の鍵 ki は，例えば PUF（Physically  Unclonable  Function）又は POK\n（Physically  Obfuscated  Key ） タ イ プ の 関 数 に よ り 生 成 さ れ る （ 【 ０ ０ １\n２】）。\n暗号回路は FPGA タイプのプログラマブル回路で実現されてもよく，第２\nの鍵 ki は FPGA のプログラミングファイルを介してカスタマイズされてもよ\nい。暗号回路はソフトウェアの実装により実現されてもよく，この暗号回路\nは第３の鍵 kb を含む。第３の鍵 kb は，前記 FPGA 回路のプログラミングフ\nァイルを暗号化し，これにより外部記憶の機密性及び FPGA への鍵 ki の移転\nの機密性を付与するためのものである（【００１５】～【００１９】）。\n第２の鍵 ki の基数は，例えば関数鍵 kc の基数に等しく，第３の鍵 kb の基\n数の基数は関数鍵 kc の基数よりも大きいかまたは等しい（【００２０】，\n【００２１】）。\nこの暗号化アルゴリズムは DES アルゴリズムである（【００２２】）。\n(4)  効果\n第２の鍵 ki は，例えば秘密実装によって鍵 kc を保護する役割を果たし，\nまた，例えば鍵 ki でマスキングすることにより保護される２つの秘密関数の\n囲い込みによってカスタマイズされる標準暗号アルゴリズムからなる秘密ア\nルゴリズムを保護する役割を果たす（【００１０】，【００１１】）。\n第２の鍵 ki により導入されるマスキングは，HO-DPA 攻撃に対して保護さ\nれてもよい（【００１４】）。\n第２の鍵 ki の基数を関数鍵 kc の基数に等しくしたため，ki への隠しチャネ\nル攻撃は kc への暗号解読攻撃よりも困難になる（【００２０】）。\n４  検討\n(1)  便宜上，取消事由４（実施可能要件に関する判断の誤り）について，ま\nず検討する。\n(2)ア  本願発明の技術思想\n(ｱ)  本願明細書等の記載（【０００７】）によれば，本願発明の目的は\n「特に DPA または EMA タイプの攻撃に対抗すること」であって，この\n目的を達成するために「本発明の対象は暗号アルゴリズムを実行する\nための関数鍵 kc を含む暗号回路であって，前記回路は kc とは別の前記\n回路のそれぞれの例に特有の，回路のサイドチャネルを利用した攻撃\nから回路を保護することを可能とする第２の鍵 ki を含むことを特徴とす\nる。」とされている。ここで，DPA 攻撃及び EMA 攻撃がサイドチャネ\nルを利用した攻撃であることは，本願明細書等の記載（【０００４】）\n及び技術常識から明らかであるから，段落【０００７】の上記記載に\nよれば，本願発明の第２の鍵 ki は，DPA 攻撃及び EMA 攻撃のようなサ\nイドチャネルを利用した攻撃から暗号回路を保護するという目的を達\n成するためのものと認められる。\nまた，本願明細書等には，関数鍵 kc が第２の鍵 ki と XOR 演算されて\nマスク鍵 kc⊕ki となる旨の記載（【０００９】）に続き，「第２の鍵 ki\nは例えば秘密実装によって鍵 kc を保護する役割を果たす。」（【００\n１０】）との記載がある。他方，段落【００４１】には，関数鍵 kc と\n非機能の鍵 ki とを XOR 演算して kc⊕ki にする旨の記載に続き，「鍵 ki は\nしたがって DES 実装の関数鍵 kc を磁気放射または特に瞬間消費の観測\nによる情報漏洩２４から保護する役割を果たす。」との記載がある。こ\nの「磁気放射または特に瞬間消費の観測による情報漏洩２４」が EMA\n攻撃及び DPA 攻撃で用いるサイドチャネルからの情報漏洩のことを指\nしていることは，段落【０００４】及び技術常識から明らかである。そ\nうすると，段落【００４１】の上記記載は，段落【０００９】及び段落\n【００１０】の上記各記載をより具体的に記載したものであると認めら\nれる。そして，これらの記載から，第２の鍵 ki は，関数鍵 kc と XOR 演\n算をすることにより関数鍵 kc のマスクとして働き，関数鍵 kc を DPA 攻\n撃及び EMA 攻撃から保護する役割を果たすものと理解される。\nそうすると，本願発明の目的である「サイドチャネルを利用した攻撃\nから回路を保護すること」は，段落【０００９】，【００１０】及び\n【００４１】で言及されているサイドチャネルを利用した攻撃から関数\n鍵 kc を保護することを意味し，この保護は関数鍵 kc を第２の鍵（又は\n非機能の鍵）ki でマスクする，すなわち kc と ki を XOR 演算することに\nよって達成されるものと理解される。換言すれば，本願発明の暗号回路\nにおいてサイドチャネルを利用した攻撃の目標として想定されているの\nは関数鍵 kc であり，この関数鍵 kc をそのような攻撃から保護するため\nに第２の鍵 ki を必要とし，関数鍵 kc を第２の鍵 ki と XOR 演算すること\nによってマスクする（マスク鍵 kc⊕ki とする）という方法によって，関\n数鍵 kc の保護が達成されるものと把握される。\nさらに，本願明細書等には，サイドチャネルを利用した攻撃の具体的\nな目標として関数鍵 kc 以外のものは記載されていない。\nこのように，本願発明が想定している攻撃目標は関数鍵 kc であり，\nそれ以外の攻撃目標を想定しない以上，本願発明の暗号回路が出力する\n暗号文 y の秘密性は関数鍵 kc に依拠し，暗号文の計算手順（すなわち本\n願発明の「暗号化アルゴリズム」）に依拠するものではないと認められ\nる。そうであれば，関数鍵 kc が判明すれば，本願発明により出力され\nる暗号文 y を解読し得ることになる。これは，本願発明の暗号回路が出\n力する暗号文 y の暗号鍵が関数鍵 kc であることを意味する。すなわち，\n本願発明は，秘密情報である関数鍵 kc を用いて平文 x から暗号文 y を計\n算する関数を F で表したとき，y=F（x，kc）を満たす暗号文 y を出力す\nる暗号回路であると認められる（以下，この技術思想を「本願技術思想\n①」という。）。\nこのように理解することは，本願明細書等の「関数鍵 kc が回路２１\nの暗号化を実施する役割を果たす。この暗号化は例えばレジスタ２２の\n内部で入力変数 x を暗号化された変数 y=DES（x，kc）に変換する DES\nアルゴリズム２３である。」（【００４０】）との記載とも整合する。\n(ｲ)  また，前記のとおり，本願発明の暗号回路の保護は関数鍵 kc を第２\nの鍵 ki でマスクすることによって達成される。このため，本願発明の暗\n号回路において実際に実行される計算処理に当たっては，関数鍵 kc を\n第２の鍵 ki と分離した形で使用してはならず，常にマスク鍵 kc⊕ki を用\nいなければならないこととなる。すなわち，本願発明の暗号回路にお\nいて実際に実行される計算処理に当たっては，単体の関数鍵 kc の入力\nを要する上記関数 F とは別の計算方法により，単体の関数鍵 kc を直接\n用いず上記マスク鍵のみを用いることによって暗号文 y を計算する必要\nがある（ただし，マスク鍵自体を生成する部分において関数鍵 kc を直\n接用いることは許される。）。\nこのような，単体の関数鍵 kc を直接用いずマスク鍵のみを用いるこ\nとにより平文 x から暗号文 y を計算する関数を G で表すと，本願発明の\n暗号回路は，暗号文 y の実際の計算を y=G（x，kc⊕ki）によって計算す\nるものであると認められる（以下，この技術思想を「本願技術思想②」\nという。）。\nイ(ｱ)  上記本願技術思想①及び②によれば，本願発明の暗号回路を具現化\nするためには，暗号回路によって実際に計算された暗号文と，暗号化ア\nルゴリズム F に基づいて計算された暗号文とが等しいこと，すなわち\nG（x，kc⊕ki）=F（x，kc）\nを満たすことが要求される（以下，この要求を「本願発明の技術的要求」\nという。）。\nしかし，本願発明の技術的要求を満たす関数 G を構成する計算方法\nが，当業者の技術常識に鑑みて自明であると認めるに足りる証拠はない。\nそこで，G（x，kc⊕ki）の具体的な計算方法が本願明細書等に示されて\nいるかについて，以下検討する。\n(ｲ)  本願明細書等の記載のうち，本願発明の技術分野，背景技術及び課\n題を解決するための手段の記載（【０００１】～【００２４】）並び\nに本願発明の実施形態のうち図４に係る部分の記載（【００４０】～\n【００５２】）には，前記のとおり，本願技術思想①及び②が開示さ\nれている。しかし，本願発明の技術的要求を満たす関数 G の具体的態\n様について開示したものと理解される記載は見当たらない。\nまた，特許請求の範囲の記載は，上記記載の内容を超えるものではな\nく，関数 G の具体的態様は記載されていない。\n(ｳ)ａ  本願明細書等の記載のうち，図１及び２並びにこれらに関する段\n落【００２５】～【００３６】の部分を見ると，DES アルゴリズム\nのマスキングの図として，図１及び２が示されており，両図は同様の\n回路であるとされている（【００２５】，【００２６】）。そして，\n図１の IP２に対して入力される「マスク」は，図２においては ki と\nして示されていることから，図１及び２において IP に入力されるマ\nスク ki は，本願発明の第２の鍵 ki であると認められる。\nまた，図１及び２における S９への入力に注目すると，E から出力\nされる xm が kc と XOR 演算されていることから，図１及び２に示され\nる kc は，関数鍵 kc であると認められる。\nｂ  しかし，図１及び２の回路において，マスク鍵 kc⊕ki は作成されて\nいない。\n上記のとおり，関数鍵 kc と XOR 演算されるものは xm であるとこ\nろ，これは，「右のマスクされるデータ（Ri）」６に E を適用したも\nの（E(Ri)）である。図１及び２によれば，この Ri は，「メッセージ」\nに IP１を適用したものの右半分と，第２の鍵 ki に IP２を適用したも\nのの右半分との XOR 演算の結果であって，第２の鍵 ki とは異なる。\n他方，xm⊕kc の計算結果を数式で表すと，メッセージを MES とし，\n値の右半分を得る関数を RH とした場合，\nxm⊕kc=E(Ri)⊕kc=E(RH(IP(MES))⊕RH(IP(ki)))⊕kc\nとなる。ここで，E は技術常識に鑑みて拡大置換 E を意味し，入力の\n３２ビットのうち１６ビットが重複して使用されて出力４８ビットに\n置換されるものである（乙１）。そうすると，E は XOR 演算に対し\nて分配的に作用し，\nxm⊕kc=E(RH(IP(MES)))⊕E(RH(IP(ki)))⊕kc\nとなる。この計算結果のうち，kc 及び ki に関する部分のみを取り出し\nてみても，kc⊕E(RH(IP(ki)))（以下「式(A)」という。）が計算されて\nいるに過ぎず，明らかに kc⊕ki とは異なる。\n仮に，IP が DES の初期置換であって単にビット位置を入れ替えて\nいるに過ぎないから無視できるとし，かつ，右半分の演算のみに注目\nすることで RH を無視できるとしても，前記のとおり E は拡大置換で\nあるからこれを無視することはできず，kc⊕E(ki)は，kc⊕ki はもちろん\nE(kc)⊕E(ki)とも異なるものとなる。\nｃ  以上のとおり，本願明細書等の図１及び２に示される回路において\nは，そもそもマスク鍵 kc⊕ki が計算されているとは認められないこと\nから，両図の回路をもって関数 G（x，kc⊕ki）の具体的態様を開示し\nたものということはできない。\nｄ  また，段落【００２８】記載の「【数２】K⊕M」は，２つの値が\nXOR 演算されているという点で本願発明のマスク鍵と共通するもの\nの，記号が異なることから，本願発明を説明したものとは認められな\nい。\n仮に当該記載が本願発明を説明したものだとすると，当該記載の\n「秘密鍵 K」は保護対象となる鍵であるから，その機能の面から本願\n発明の関数鍵 kc に該当すると解されるが，【数２】と式(A)とを比較\nすると，M=E(RH(IP(ki)))であると推測されるところ，E(RH(IP(ki)))は\n明らかに第２の鍵 ki そのものとは異なる値である。したがって，当該\n記載は，本願発明と整合せず，やはり本願発明を説明するものという\nことはできない。\nｅ  図１及び２に関する本願明細書等のその他の記載にも，関数 G の\n具体的態様を開示したものと見られる記載はない。\nしたがって，本願明細書【００２５】～【００３６】並びに図１\n及び２には，関数 G の具体的態様が記載されているとはいえない。\n(ｴ)  本願明細書等の記載のうち，図３及びこれに関連する段落【００３\n７】～【００３９】には，本願発明の関数鍵 kc に対応する概念が記載\nされていない。そうである以上，これらの記載及び図に関数 G（x，\nkc⊕ki）の具体的態様が記載されているとはいえない。\nなお，図３は図１及び２において Feistel 関数 f を示す囲みと一見類似\nするようにみえるけれども，図１及び２と図３にそれぞれ現れる要素の\n異同ないし対応関係は不明というほかなく，また，図１及び２に関する\n説明（【００２５】～【００３６】）に続いて「図３は別の進行方式を\n示す。」（【００３７】）と記載されていることに鑑みると，図１及び\n２と図３との間には技術的関連性はなく，相互に独立したものと見るの\nが相当である。このため，図１～３を総合的に見ても，関数 G の具体\n的態様は明らかでない。\nウ  以上より，本願明細書等には関数 G の具体的態様が記載されていない\nというべきである。そうである以上，本願発明を具現化して実施するこ\nとはできない。\nしたがって，本願明細書等の発明の詳細な説明の記載は，本願発明の\n属する技術の分野における通常の知識を有する者がその実施をすること\nができる程度に明確かつ十分に記載したものということはできないから，\n法３６条４項１号に違反する。これと同旨をいう本件審決に誤りはない。\nエ  原告の主張について\n(ｱ)  原告は，本願明細書等の記載（【００２７】，【００２８】）並び\nに図１及び２から，両図に示される回路の（マスク m によってマスク\nされる）暗号鍵 kc が，（マスク M によってマスクされる）秘密鍵 K と\n同一であり，かつ，秘密鍵とは，暗号文 y の復号化に必要な鍵であって\n暗号化アルゴリズム F（x，k）を実行するための鍵 k であると定義され\nるから，図１及び２に示される回路で暗号化アルゴリズム F（x，kc）を\n実行すると，暗号文 y=F（x，kc）が出力される（秘密鍵 kc が暗号文 y\nの復号化に必要な鍵である）ということが示されているといえ，これ\nは，本願の請求項１の「暗号化アルゴリズムを実行するための関数鍵 kc\nを含む暗号回路（２１）」の記載に相当する旨主張する。\nしかし，前記のとおり，本願明細書等の図１及び２並びにそれらを説\n明する段落【００２５】～【００３６】を参照しても，両図の S’がど\nのような関数であるかが不明であるため，そこに示される暗号回路の動\n作は不明であり，その回路が暗号文 y=F（x，kc）を出力するものであ\nるか否かは定かではない。\nまた，本願明細書等には「図１に本発明が適用されうるマスキングの\nモードを呈示する。」（【００２５】），「対比のために，図２はマス\nキングによる保護を保証するためのハードウェアオーバーヘッドを強調\nする同様の回路を示し，このオーバーヘッドを生じさせる回路は破線に\nより示されている。」（【００２６】）との記載があるが，これらの記\n載の意味は明確とはいえず，図１及び２の回路が DES と同じ出力を保\n証しているとまでは読み取れない。\nさらに，本願発明は関数鍵 kc を第２の鍵 ki で XOR 演算してマスク鍵\nkc⊕ki を作成し，入力変数 x をマスク鍵で暗号化するものであるところ，\n前記のとおり，図１及び２の回路においてはマスク鍵 kc⊕ki が計算され\nていないのであるから，両図の回路が本願発明の実施形態であるとは認\nめられない。\n(ｲ)  原告は，本願明細書等の図４には，関数鍵 kc がマスク（第２の鍵）ki\nと XOR 演算されたマスク鍵 kc⊕ki が DES アルゴリズム２３の内部のレ\nジスタ２２に入力されること，及び入力変数 x が DES アルゴリズム２\n３に入力されることが示されているから，DES アルゴリズム２３に入\n力された入力変数 x は，DES アルゴリズム２３の内部のレジスタ２２に\n入力されたマスク鍵 kc⊕ki によって暗号化されることを当業者であれば\n理解する旨主張するとともに，本願明細書等の記載（【００２７】）\n並びに図１及び２によれば，図１ないし図２の XOR ゲート８で，メッ\nセージデータ（入力変数 x）と第２の鍵 ki が XOR 演算（x⊕ki）され，そ\nの演算結果がレジスタ６を経て Feistel 関数１０に入力され，E で示され\nる箇所を経て，関数鍵 kc と XOR 演算（x⊕ki⊕kc）されていることが理解\nされるところ，排他的論理和⊕（XOR 演算子）は交換法則及び結合法則\nが成立し，これらを適用すれば，x⊕ki⊕kc は x⊕(kc⊕ki）となるから，図１\n及び２には「 マ ス ク 鍵 kc⊕ki によって入力変数 x が暗号化され\n（x⊕(kc⊕ki)）」という事項が示されている旨主張する。\nしかし，まず，本願明細書等の図４を参照しても，レジスタ２２に格\n納されたマスク鍵 kc⊕ki が DES アルゴリズム２３において果たす役割に\nついては記載されていないことから，レジスタ２２に格納されたマスク\n鍵により入力変数 x が暗号化されることを読み取ることはできない。か\nつ，レジスタ２２について，本願明細書等には「関数鍵 kc が回路２１\nの暗号化を実施する役割を果たす。この暗号化は例えばレジスタ２２の\n内部で入力変数 x を暗号化された変数 y=DES（x，kc）に変換する DES\nアルゴリズム２３である。」（【００４０】）との記載はあるものの，\n当該記載はレジスタ２２にマスク鍵 kc⊕ki が入力されることすら開示し\nていない。\nまた，本願明細書等の図１及び２については，前記のとおり，そもそ\nも，両図の回路は本願発明の実施形態とはいえない。しかも，原告の主\n張に係る計算手順の説明は，初期置換 IP，値の右半分を得る関数 RH\n（図示されない）及び拡大置換 E の影響を無視したものであって，妥当\nでない。仮に IP，RH 及び E の影響を無視し得るとしても，図１及び２\nの計算手順は，入力変数 x と第２の鍵 ki とを XOR し，その結果と関数\n鍵 kc とを XOR することにより x⊕ki⊕kc を得ており，マスク鍵 kc⊕ki を計\n算してから入力変数 x とマスク鍵とを XOR するものではない。すなわ\nち，この点に関する原告の主張は，図１及び２の計算手順を無視したも\nのというべきである。\n(ｳ)  原告は，本願明細書等の記載（【００３７】）及び図３によれば，\n同図において，入力データ X が x⊕kc であり，マスク M が第２の鍵 ki で\nあるとすると，レジスタ３１の前段の XOR 演算部で x⊕kc⊕ki の演算がさ\nれ，いずれのレジスタにおいても第２の鍵 ki によってマスキングがされ\nることにより，x⊕kc は漏洩されないが，レジスタ３５の後段の XOR 演\n算部からは，第２の鍵 ki がデマスキングされた EE（x⊕kc）が出力され\nるという事項が示されていること，図２においても，図３と同様に，\nFeistel 関数１０内の E の後段の XOR 演算部で x⊕kc⊕ki の演算がされ，い\nずれのレジスタにおいても第２の鍵 ki によってマスキングがされて，\nx⊕kc は漏洩されないが，XOR 演算部１３，１４からは，第２の鍵 ki が\nデマスキングされた暗号文が出力されるという事項が示されている旨\n主張する。\nしかし，前記のとおり，そもそも，本願明細書等の図１及び２の回路\nは本願発明の実施形態であるとはいえないし，図２の Feistel 関数１０内\nの E の後段の XOR 演算部で演算された結果は，原告の主張する x⊕kc⊕ki\nではなく，E(RH(IP(MES))⊕RH(IP(ki)))⊕kc である。仮に，図２の Feistel\n関数１０内の E の後段の XOR 演算部で演算された結果が x⊕kc⊕ki であっ\nたとしても，原告の主張は図２における x⊕kc，ki，S 及び S’がそれぞれ\n図３における X，M，EE 及び EE’に対応することを前提とするところ，\n本願明細書等の記載からそのような対応関係を理解し得ないことは前記\nイ(ｴ)のとおりである。\n(ｴ)  原告は，暗号回路を実施するための事項以外の事項である復号を実\n施するための事項が発明の詳細な説明に記載されていないことをもっ\nて，実施可能要件を満たしていないということにはならない旨主張す\nるけれども，前記のとおり，本願明細書等は，暗号回路としての本願\n発明を実施するための事項（本願発明の技術的要求を満たすような具\n体的な関数 G）が理解できるように記載されていない。\n(ｵ)  原告は，本願発明において，第２の鍵 ki は，マスク鍵 kc⊕ki のために\n使用される一方で，XOR 演算を繰り返すことによって消去されるから，\n本願明細書等の図２の出力１５から最終的に得られた暗号文 y を解読す\nるためには，関数鍵 kc さえ知り得ればよく，第２の鍵 ki を要しない旨\n主張する。\nしかし，原告の上記主張は，暗号文 y（=DES（x，kc））と x⊕kc とを\n混同するものであり，その前提に誤りがある。\n(ｶ)  その他原告がるる指摘する事情を考慮しても，この点に関する原告\nの主張は採用し得ない。\n(3)  以上のとおり，本願明細書等の発明の詳細な説明の記載は実施可能要件\nを満たさないとする本件審決に誤りはなく，少なくとも原告主張に係る取消\n事由４については理由がない。そうすると，その余について論ずるまでもな\nく，原告の請求は理由がないというべきである。\n５  結論\nよって，原告の請求は理由がないからこれを棄却することとし，主文のとお\nり判決する。\n知的財産高等裁判所第３部\n裁判長裁判官\n鶴 岡 稔 彦\n裁判官\n杉 浦 正 樹\n裁判官\n寺 田 利 彦\n"
}